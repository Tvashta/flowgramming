<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, shrink-to-fit=no"
        />
        <title>Flowgramming</title>
        <link
            rel="stylesheet"
            href="../assets/bootstrap/css/bootstrap.min.css"
        />
        <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css?family=Montserrat:400,400i,700,700i,600,600i"
        />
        <link rel="stylesheet" href="../assets/fonts/ionicons.min.css" />
        <link rel="stylesheet" href="../css/Contact-Form-Clean.css" />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/baguettebox.js/1.10.0/baguetteBox.min.css"
        />
        <link rel="stylesheet" href="../css/vanilla-zoom.min.css" />
    </head>
    <body>
        <main class="page contact-us-page">
            <section class="clean-block clean-form dark">
                <div class="container">
                    <div class="block-heading">
                        <h2 class="text-info">List of Problems</h2>
                    </div>
                </div>
            </section>
        </main>
        <ul class="text-center" id="problems"></ul>
        <section class="contact-clean">
            <form id="addproblem">
                <h2 class="text-info">Add a Problem</h2>
                <div class="mb-3">
                    <input
                        class="form-control"
                        placeholder="Name"
                        type="text"
                        name="name"
                    />
                </div>
                <div class="mb-3">
                    <input
                        class="form-control"
                        placeholder="Problem Statement"
                        type="text"
                        name="problemStatement"
                    />
                </div>
                <div class="mb-3">
                    <input
                        class="form-control"
                        placeholder="Constraints"
                        id="constraints"
                        type="text"
                        name="constraints"
                    />
                    <button
                        class="btn btn-primary"
                        onclick="addValue(event)"
                        name="constraints"
                        type="button"
                    >
                        +
                    </button>
                    <ul id="constraintsList"></ul>
                </div>
                <div class="mb-3">
                    <input
                        class="form-control"
                        placeholder="Sample Input"
                        id="sampleInput"
                        type="text"
                        name="sampleInput"
                    />
                    <button
                        class="btn btn-primary"
                        onclick="addValue(event)"
                        name="sampleInput"
                        type="button"
                    >
                        +
                    </button>
                    <ul id="sampleInputList"></ul>
                </div>
                <div class="mb-3">
                    <input
                        class="form-control"
                        placeholder="Sample Output"
                        id="sampleOutput"
                        type="text"
                        name="sampleOutput"
                    />
                    <button
                        class="btn btn-primary"
                        onclick="addValue(event)"
                        name="sampleOutput"
                        type="button"
                    >
                        +
                    </button>
                    <ul id="sampleOutputList"></ul>
                </div>
                <div class="mb-3">
                    <input
                        class="form-control"
                        type="text"
                        name="explanation"
                        placeholder="Explanation"
                    />
                </div>
                <!--    <input type='file' name='image'/>-->
                <div class="mb-3">
                    <input
                        class="form-control"
                        type="number"
                        name="timeLimit"
                        placeholder="Time Limit [in s]"
                    />
                </div>
                <div class="mb-3">
                    <input
                        class="form-control"
                        type="number"
                        name="memoryLimit"
                        placeholder="Memory Limit [in MB]"
                    />
                </div>
                <div class="mb-3">
                    <input
                        class="form-control"
                        placeholder="Problem Type"
                        id="problemType"
                        type="text"
                        name="problemType"
                    />
                    <button
                        class="btn btn-primary"
                        onclick="addValue(event)"
                        name="problemType"
                        type="button"
                    >
                        +
                    </button>
                    <ul id="problemTypeList"></ul>
                </div>
                <button class="btn btn-primary" type="submit">Add</button>
            </form>
        </section>
        <script src="js/build/codeVendor.js"></script>
        <script src="js/build/codeMain.js"></script>
        <script>
            var constraints = [],
                sampleInput = [],
                sampleOutput = [],
                problemType = []

            function addValue(e) {
                let val = $(`#${e.target.name}`).val()
                this[`${e.target.name}`].push(val)
                $('#' + e.target.name).val('')
                $(`#${e.target.name}List`).append('<li>' + val + '</li>')
            }

            $('#addproblem').on('submit', function (event) {
                event.preventDefault()
                addProblem()
            })
            $('#problems').click(function (event) {
                let id = $(event.target).attr('data-id')
                openNewTab('viewProblem.html', id)
            })

            window.onload = () => {
                fetch('http://localhost:4000/problems')
                    .then((response) => response.json())
                    .then((data) => {
                        data.map((x) => {
                            $('#problems').append(
                                '<li data-id=' +
                                    x._id +
                                    '>' +
                                    x.name +
                                    '</li><button onclick="deleteProblem(\'' +
                                    x._id +
                                    '\')" type="submit">Delete</button>'
                            )
                        })
                    })
            }

            function deleteProblem(id) {
                return fetch('http://localhost:4000/problems/' + id, {
                    method: 'DELETE',
                }).then((response) => {
                    location.reload()
                })
            }

            async function addProblem() {
                let formArray = $('#addproblem').serializeArray()
                let formData = {}
                for (let i = 0; i < formArray.length; i++) {
                    formData[formArray[i]['name']] = formArray[i]['value']
                }
                if (formData['constraints'] !== '')
                    constraints.push(formData['constraints'])
                formData['constraints'] = constraints

                if (formData['sampleInput'] !== '')
                    sampleInput.push(formData['sampleInput'])
                formData['sampleInput'] = sampleInput

                if (formData['sampleOutput'] !== '')
                    sampleOutput.push(formData['sampleOutput'])
                formData['sampleOutput'] = sampleOutput

                if (formData['problemType'] !== '')
                    problemType.push(formData['problemType'])
                formData['problemType'] = problemType
                await fetch('http://localhost:4000/problems', {
                    method: 'POST',
                    mode: 'cors',
                    referrerPolicy: 'no-referrer',
                    headers: {
                        Accept: 'application/json',
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData),
                })
                location.reload()
            }
        </script>
    </body>
</html>
