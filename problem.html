<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, shrink-to-fit=no"
        />
        <title>Flowgramming</title>
        <link
            rel="stylesheet"
            href="../assets/bootstrap/css/bootstrap.min.css"
        />
        <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css?family=Montserrat:400,400i,700,700i,600,600i"
        />
        <link rel="stylesheet" href="../assets/fonts/ionicons.min.css" />
        <link rel="stylesheet" href="../css/Contact-Form-Clean.css" />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/baguettebox.js/1.10.0/baguetteBox.min.css"
        />
        <link rel="stylesheet" href="../css/vanilla-zoom.min.css" />
        <link
            rel="stylesheet"
            href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"
        />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    </head>
    <body>
        <main class="page contact-us-page">
            <section class="clean-block clean-form dark">
                <div class="container">
                    <div class="block-heading">
                        <h2 class="text-info">List of Problems</h2>
                    </div>
                    <ul class="text-center" id="problems"></ul>
                </div>
            </section>
        </main>
        <h2>Click here to add a new problem</h2>
        <!-- Trigger the modal with a button -->
        <button
            type="button"
            class="btn btn-info btn-lg"
            data-toggle="modal"
            data-target="#myModal"
        >
            Add Problem
        </button>

        <!-- Modal -->
        <div class="modal fade" id="myModal" role="dialog">
            <div class="modal-dialog">
                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <button
                            type="button"
                            class="close"
                            data-dismiss="modal"
                        >
                            &times;
                        </button>
                    </div>
                    <div class="modal-body">
                        <section class="contact-clean">
                            <form id="addproblem">
                                <h2 class="text-info">Add a Problem</h2>
                                <div class="mb-3">
                                    <input
                                        class="form-control"
                                        placeholder="Name"
                                        type="text"
                                        name="name"
                                    />
                                </div>
                                <div class="mb-3">
                                    <input
                                        class="form-control"
                                        placeholder="Problem Statement"
                                        type="text"
                                        name="problemStatement"
                                    />
                                </div>
                                <div class="mb-3">
                                    <input
                                        class="form-control"
                                        placeholder="Constraints"
                                        id="constraints"
                                        type="text"
                                        name="constraints"
                                    />
                                    <button
                                        class="btn btn-primary"
                                        onclick="addValue(event)"
                                        name="constraints"
                                        type="button"
                                    >
                                        +
                                    </button>
                                    <ul id="constraintsList"></ul>
                                </div>
                                <div class="mb-3">
                                    <input
                                        class="form-control"
                                        placeholder="Sample Input"
                                        id="sampleInput"
                                        type="text"
                                        name="sampleInput"
                                    />
                                    <button
                                        class="btn btn-primary"
                                        onclick="addValue(event)"
                                        name="sampleInput"
                                        type="button"
                                    >
                                        +
                                    </button>
                                    <ul id="sampleInputList"></ul>
                                </div>
                                <div class="mb-3">
                                    <input
                                        class="form-control"
                                        placeholder="Sample Output"
                                        id="sampleOutput"
                                        type="text"
                                        name="sampleOutput"
                                    />
                                    <button
                                        class="btn btn-primary"
                                        onclick="addValue(event)"
                                        name="sampleOutput"
                                        type="button"
                                    >
                                        +
                                    </button>
                                    <ul id="sampleOutputList"></ul>
                                </div>
                                <div class="mb-3">
                                    <input
                                        class="form-control"
                                        type="text"
                                        name="explanation"
                                        placeholder="Explanation"
                                    />
                                </div>
                                <!--    <input type='file' name='image'/>-->
                                <div class="mb-3">
                                    <input
                                        class="form-control"
                                        type="number"
                                        name="timeLimit"
                                        placeholder="Time Limit [in s]"
                                    />
                                </div>
                                <div class="mb-3">
                                    <input
                                        class="form-control"
                                        type="number"
                                        name="memoryLimit"
                                        placeholder="Memory Limit [in MB]"
                                    />
                                </div>
                                <div class="mb-3">
                                    <input
                                        class="form-control"
                                        placeholder="Problem Type"
                                        id="problemType"
                                        type="text"
                                        name="problemType"
                                    />
                                    <button
                                        class="btn btn-primary"
                                        onclick="addValue(event)"
                                        name="problemType"
                                        type="button"
                                    >
                                        +
                                    </button>
                                    <ul id="problemTypeList"></ul>
                                </div>
                                <button class="btn btn-primary" type="submit">
                                    Add
                                </button>
                            </form>
                        </section>
                    </div>
                    <div class="modal-footer">
                        <button
                            type="button"
                            class="btn btn-default"
                            data-dismiss="modal"
                        >
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <script src="js/build/codeVendor.js"></script>
        <script src="js/build/codeMain.js"></script>
        <script>
            var constraints = [],
                sampleInput = [],
                sampleOutput = [],
                problemType = []

            function addValue(e) {
                let val = $(`#${e.target.name}`).val()
                this[`${e.target.name}`].push(val)
                $('#' + e.target.name).val('')
                $(`#${e.target.name}List`).append('<li>' + val + '</li>')
            }

            $('#addproblem').on('submit', function (event) {
                event.preventDefault()
                addProblem()
            })
            $('#problems').click(function (event) {
                let id = $(event.target).attr('data-id')
                openNewTab('viewProblem.html', id)
            })

            window.onload = () => {
                fetch('http://localhost:5000/problems')
                    .then((response) => response.json())
                    .then((data) => {
                        data.map((x) => {
                            $('#problems').append(
                                '<li data-id=' +
                                    x._id +
                                    '>' +
                                    x.name +
                                    '</li><button onclick="deleteProblem(\'' +
                                    x._id +
                                    '\')" class = "btn btn-primary" type="submit">Delete</button>'
                            )
                        })
                    })
            }

            function deleteProblem(id) {
                return fetch('http://localhost:5000/problems/' + id, {
                    method: 'DELETE',
                }).then((response) => {
                    location.reload()
                })
            }

            async function addProblem() {
                let formArray = $('#addproblem').serializeArray()
                let formData = {}
                for (let i = 0; i < formArray.length; i++) {
                    formData[formArray[i]['name']] = formArray[i]['value']
                }
                if (formData['constraints'] !== '')
                    constraints.push(formData['constraints'])
                formData['constraints'] = constraints

                if (formData['sampleInput'] !== '')
                    sampleInput.push(formData['sampleInput'])
                formData['sampleInput'] = sampleInput

                if (formData['sampleOutput'] !== '')
                    sampleOutput.push(formData['sampleOutput'])
                formData['sampleOutput'] = sampleOutput

                if (formData['problemType'] !== '')
                    problemType.push(formData['problemType'])
                formData['problemType'] = problemType
                await postReq('http://localhost:5000/problems', formData)
                location.reload()
            }
        </script>
    </body>
</html>
<!-- <input type='file' name='image'/> -->
